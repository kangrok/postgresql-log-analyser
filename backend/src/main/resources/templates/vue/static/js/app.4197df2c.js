(function(){"use strict";var e={7040:function(e,t,a){var n=a(9242),r=a(3396);function s(e,t,a,n,s,l){const i=(0,r.up)("v-toolbar-title"),o=(0,r.up)("v-app-bar"),u=(0,r.up)("AnalysisPage"),d=(0,r.up)("UploadPage"),p=(0,r.up)("v-container"),c=(0,r.up)("v-app");return(0,r.wg)(),(0,r.j4)(c,null,{default:(0,r.w5)((()=>[(0,r.Wm)(o,{app:"",density:"comfortable",elevation:"0",color:"#3F51B5"},{default:(0,r.w5)((()=>[(0,r.Wm)(i,null,{default:(0,r.w5)((()=>[(0,r.Uk)("PostgreSQL logide analüsaator")])),_:1})])),_:1}),(0,r.Wm)(p,{class:"content pt-16"},{default:(0,r.w5)((()=>[e.showAnalysis?((0,r.wg)(),(0,r.j4)(u,{key:0,onUpload:t[0]||(t[0]=e=>this.showAnalysis=!1),"analysis-result":this.analysis},null,8,["analysis-result"])):((0,r.wg)(),(0,r.j4)(d,{key:1,onAnalysis:e.openAnalysis},null,8,["onAnalysis"]))])),_:1})])),_:1})}var l=a(7139);const i=e=>((0,r.dD)("data-v-4cee9d35"),e=e(),(0,r.Cn)(),e),o={class:"container"},u=i((()=>(0,r._)("h3",{class:"pb-4"}," Analüüsi ajavahemik ",-1)));function d(e,t,a,n,s,i){const d=(0,r.up)("v-card-title"),p=(0,r.up)("v-spacer"),c=(0,r.up)("v-alert"),m=(0,r.up)("v-file-input"),y=(0,r.up)("v-card-text"),v=(0,r.up)("v-radio"),g=(0,r.up)("v-text-field"),h=(0,r.up)("v-col"),f=(0,r.up)("v-radio-group"),w=(0,r.up)("v-btn"),b=(0,r.up)("v-card-actions"),k=(0,r.up)("v-card");return(0,r.wg)(),(0,r.iD)("div",o,[(0,r.Wm)(k,{class:"upload-container pa-6 rounded-0",border:""},{default:(0,r.w5)((()=>[(0,r.Wm)(d,null,{default:(0,r.w5)((()=>[(0,r.Uk)("Laadi üles logifailide kaust")])),_:1}),(0,r.Wm)(p),(0,r.Wm)(y,null,{default:(0,r.w5)((()=>[s.uploadFailed?((0,r.wg)(),(0,r.j4)(c,{key:0,class:"mb-6 rounded-0",color:"red",variant:"tonal"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,l.zw)(this.errorMessage),1)])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(m,{clearable:"",label:"Vali fail...",variant:"solo-filled","prepend-icon":"mdi-folder-upload",onChange:i.upload},null,8,["onChange"])])),_:1}),(0,r.Wm)(y,null,{default:(0,r.w5)((()=>[u,(0,r.Wm)(f,{modelValue:s.periodSelection,"onUpdate:modelValue":t[2]||(t[2]=e=>s.periodSelection=e)},{default:(0,r.w5)((()=>[(0,r.Wm)(v,{label:"Kõik logid",value:"all"}),(0,r.Wm)(v,{label:"Viimane nädal",value:"week"}),(0,r.Wm)(v,{label:"Muu ajavahemik",value:"custom"}),(0,r.Wm)(h,{class:"pl-12",style:{"max-width":"360px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(g,{type:"datetime-local",prefix:"Algus:",disabled:"custom"!==s.periodSelection,modelValue:s.selectedStartDate,"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedStartDate=e)},null,8,["disabled","modelValue"]),(0,r.Wm)(g,{type:"datetime-local",prefix:"Lõpp:",disabled:"custom"!==s.periodSelection,modelValue:s.selectedEndDate,"onUpdate:modelValue":t[1]||(t[1]=e=>s.selectedEndDate=e)},null,8,["disabled","modelValue"])])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,r.Wm)(b,null,{default:(0,r.w5)((()=>[(0,r.Wm)(p),(0,r.Wm)(w,{color:"#3F51B5",type:"submit",variant:"elevated",onClick:i.analyse},{default:(0,r.w5)((()=>[(0,r.Uk)(" Analüüsi ")])),_:1},8,["onClick"])])),_:1})])),_:1})])}var p=a(4161),c={data(){return{uploadedFile:void 0,periodSelection:"all",errorMessage:"",startDate:void 0,endDate:void 0,selectedStartDate:(new Date).toISOString().substring(0,16),selectedEndDate:(new Date).toISOString().substring(0,16),uploadFailed:!1}},methods:{upload(e){this.uploadedFile=e.target.files[0]},analyse(){if(!this.uploadedFile)return void(this.errorMessage="Vali zip-fail või logifail.");if(!this.validateDates())return void(this.errorMessage="Valitud alguskuupäev peab olema enne lõpukuupäeva.");const e=this.uploadedFile.name.endsWith(".zip")?"zip":"single";p.Z.post("/analysis/"+e,this.createRequestData(),{headers:{"Content-Type":"multipart/form-data"}}).then((e=>this.$emit("analysis",e.data))).catch((()=>{this.uploadFailed=!0,this.errorMessage="Faili üleslaadimine ebaõnnestus. Kontrolli, et valitud fail on õiges formaadis (.zip, .json või .log)."}))},validateDates(){return"custom"===this.periodSelection?(this.startDate=new Date(this.selectedStartDate),this.endDate=new Date(this.selectedEndDate),this.startDate<=this.endDate):("week"===this.periodSelection&&(this.endDate=new Date,this.startDate=new Date(this.endDate.getTime()-6048e5)),!0)},createRequestData(){const e=new FormData;return e.append("logs",this.uploadedFile),"all"!==this.periodSelection&&(e.append("start",this.startDate.toISOString()),e.append("end",this.endDate.toISOString())),e}}},m=a(89);const y=(0,m.Z)(c,[["render",d],["__scopeId","data-v-4cee9d35"]]);var v=y;const g={class:"result-container"};function h(e,t,a,n,s,l){const i=(0,r.up)("v-btn"),o=(0,r.up)("v-list-item"),u=(0,r.up)("v-divider"),d=(0,r.up)("v-navigation-drawer"),p=(0,r.up)("AnalysisSummary");return(0,r.wg)(),(0,r.iD)("div",g,[null!==a.analysisResult?((0,r.wg)(),(0,r.j4)(d,{key:0},{default:(0,r.w5)((()=>[(0,r.Wm)(i,{class:"ma-6",onClick:t[0]||(t[0]=e=>this.$emit("upload")),color:"#3F51B5"},{default:(0,r.w5)((()=>[(0,r.Uk)("Laadi üles uus kaust")])),_:1}),(0,r.Wm)(o,{link:"",title:"Rühma kokkuvõte",onClick:t[1]||(t[1]=e=>this.displayData=a.analysisResult.summary),class:"py-3"}),(0,r.Wm)(u),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(a.analysisResult.analysis,((e,t)=>((0,r.wg)(),(0,r.j4)(o,{link:"",title:e.studentName,onClick:t=>this.displayData=e,key:t,class:"py-3"},null,8,["title","onClick"])))),128))])),_:1})):(0,r.kq)("",!0),(0,r.Wm)(p,{analysis:this.displayData??a.analysisResult.summary},null,8,["analysis"])])}const f=e=>((0,r.dD)("data-v-8154f7fe"),e=e(),(0,r.Cn)(),e),w=f((()=>(0,r._)("h1",null,"Logide analüüs",-1))),b={key:0,class:"pb-2"},k={key:1,class:"pb-6"},C={key:2},_=f((()=>(0,r._)("thead",null,null,-1))),D=f((()=>(0,r._)("td",null,"Päringute koguarv:",-1))),E=f((()=>(0,r._)("td",null,"Edukate päringute arv:",-1))),x={class:"valid-text-color"},N=f((()=>(0,r._)("td",null,"Vigaste päringute arv:",-1))),S={class:"error-text-color"},j={key:0},W=f((()=>(0,r._)("td",null,"Keskmine vigade arv tudengi kohta:",-1))),V={key:1},A=f((()=>(0,r._)("td",null,"Ühekordsete vigade arv:",-1))),O=f((()=>(0,r._)("h3",{class:"pb-6"},"Veatüüpide jaotus",-1))),F={key:3,class:"pa-8"},z={key:1,class:"text-center"};function q(e,t,a,n,s,i){const o=(0,r.up)("v-alert"),u=(0,r.up)("v-col"),d=(0,r.up)("v-row"),p=(0,r.up)("v-divider"),c=(0,r.up)("v-table"),m=(0,r.up)("v-progress-circular"),y=(0,r.up)("Bar"),v=(0,r.up)("v-container"),g=(0,r.up)("RepeatedErrorsPanel"),h=(0,r.up)("v-card");return null!=a.analysis?((0,r.wg)(),(0,r.j4)(v,{key:0},{default:(0,r.w5)((()=>[(0,r.Wm)(v,{class:"pt-8"},{default:(0,r.w5)((()=>[w,i.isStudent&&null!=a.analysis.studentName?((0,r.wg)(),(0,r.iD)("h2",b,(0,l.zw)(a.analysis.studentName),1)):i.isStudent?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("h2",k,"Rühma kokkuvõte")),a.analysis.error?((0,r.wg)(),(0,r.j4)(o,{key:2,class:"mb-6 rounded-0",color:"red",variant:"tonal"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,l.zw)(i.errorMessage),1)])),_:1})):(0,r.kq)("",!0),i.hasLogFiles?((0,r.wg)(),(0,r.j4)(h,{key:3,class:"pt-8 rounded-0"},{default:(0,r.w5)((()=>[i.isStudent?((0,r.wg)(),(0,r.j4)(d,{key:0,class:"pb-6 px-16"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[(0,r.Uk)(" Analüüsitud failid: ")])),_:1}),(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(a.analysis.fileNames,(e=>((0,r.wg)(),(0,r.iD)("p",{key:e},(0,l.zw)(e),1)))),128))])),_:1})])),_:1})):(0,r.kq)("",!0),i.isStudent?((0,r.wg)(),(0,r.j4)(p,{key:1})):(0,r.kq)("",!0),a.analysis.validCount+a.analysis.errorCount>0?((0,r.wg)(),(0,r.iD)("div",C,[(0,r.Wm)(d,{class:"px-16 py-8"},{default:(0,r.w5)((()=>[(0,r.Wm)(c,null,{default:(0,r.w5)((()=>[_,(0,r._)("tbody",null,[(0,r._)("tr",null,[D,(0,r._)("td",null,(0,l.zw)(this.$props.analysis.errorCount+this.$props.analysis.validCount),1)]),(0,r._)("tr",null,[E,(0,r._)("td",x,(0,l.zw)(this.$props.analysis.validCount)+" ("+(0,l.zw)((100*a.analysis.validCount/(a.analysis.errorCount+a.analysis.validCount)).toFixed(1))+"%) ",1)]),(0,r._)("tr",null,[N,(0,r._)("td",S,(0,l.zw)(this.$props.analysis.errorCount)+" ("+(0,l.zw)((100*a.analysis.errorCount/(a.analysis.errorCount+a.analysis.validCount)).toFixed(1))+"%) ",1)]),null===this.$props.analysis.studentName?((0,r.wg)(),(0,r.iD)("tr",j,[W,(0,r._)("td",null,(0,l.zw)(this.$props.analysis.errorCount/4),1)])):((0,r.wg)(),(0,r.iD)("tr",V,[A,(0,r._)("td",null,(0,l.zw)(this.$props.analysis.uniqueErrorCount),1)]))])])),_:1}),a.analysis.errorCount>0||a.analysis.validCount>0?((0,r.wg)(),(0,r.j4)(m,{key:0,class:"ml-16 mt-12",size:160,width:30,"model-value":100*a.analysis.errorCount/(a.analysis.errorCount+a.analysis.validCount),color:"red-lighten-1","bg-color":"light-green-lighten-1"},null,8,["model-value"])):(0,r.kq)("",!0)])),_:1}),(0,r.Wm)(v,{class:"pa-8"},{default:(0,r.w5)((()=>[O,(0,r.Wm)(y,{data:i.chartData,options:s.chartOptions},null,8,["data","options"])])),_:1}),0!==a.analysis.repeatedErrors.length?((0,r.wg)(),(0,r.j4)(g,{key:0,errors:a.analysis.repeatedErrors},null,8,["errors"])):(0,r.kq)("",!0)])):a.analysis.error?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("p",F,"Valitud ajavahemikus ei tehtud ühtegi päringut."))])),_:1})):(0,r.kq)("",!0)])),_:1})])),_:1})):((0,r.wg)(),(0,r.iD)("div",z,[(0,r.Wm)(m,{indeterminate:"",color:"primary"})]))}var P=a(5866),U=a(9646);const R={colspan:3,class:"statement-code pa-8"};function L(e,t,a,n,s,i){const o=(0,r.up)("v-data-table"),u=(0,r.up)("v-expansion-panel-text"),d=(0,r.up)("v-expansion-panel"),p=(0,r.up)("v-expansion-panels");return(0,r.wg)(),(0,r.j4)(p,null,{default:(0,r.w5)((()=>[(0,r.Wm)(d,{title:"Korduvad vead"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,null,{default:(0,r.w5)((()=>[null!=this.errors[0].statement?((0,r.wg)(),(0,r.j4)(o,{key:0,headers:s.headers,items:a.errors,"show-expand":!0,expanded:s.expanded,"onUpdate:expanded":t[0]||(t[0]=e=>s.expanded=e),"item-value":"statement","items-per-page":"-1"},{"expanded-row":(0,r.w5)((({item:e})=>[(0,r._)("tr",null,[(0,r._)("td",R,(0,l.zw)(e.statement),1)])])),bottom:(0,r.w5)((()=>[])),_:1},8,["headers","items","expanded"])):((0,r.wg)(),(0,r.j4)(o,{key:1,headers:s.headers,items:a.errors,"items-per-page":"-1"},{bottom:(0,r.w5)((()=>[])),_:1},8,["headers","items"]))])),_:1})])),_:1})])),_:1})}var M={name:"RepeatedErrorsPanel",props:{errors:Array},data(){return{headers:[{title:"Veateade",key:"message",sortable:!1,width:450},{title:null!=this.errors[0].statement?"Korduste arv":"Kogus",key:"amount",width:100}],expanded:[]}}};const $=(0,m.Z)(M,[["render",L],["__scopeId","data-v-65b13193"]]);var K=$;U.kL.register(U.Dx,U.u,U.De,U.ZL,U.uw,U.f$);var T={name:"AnalysisSummary",components:{RepeatedErrorsPanel:K,Bar:P.$Q},props:{analysis:{studentName:String,error:String,fileNames:Array,errorCount:Number,uniqueErrorCount:Number,validCount:Number,syntaxErrorCount:Number,nonExistentValueCount:Number,constraintViolationCount:Number,alreadyExistsErrorCount:Number,aggregateErrorCount:Number,typoCount:Number,otherErrorCount:Number,repeatedErrors:Object}},data(){return{chartOptions:{plugins:{legend:{display:!1}},scales:{y:{min:0,ticks:{stepSize:1}}}}}},computed:{chartData(){return{labels:["Süntaksivead",["Defineerimata","väärtuse","kasutamine"],["Kitsenduse","rikkumine"],"Trükivead",["Agregeeritud","funktsiooni","vead"],["Topelt","defineerimine"],"Muud vead"],datasets:[{title:"Veatüüpide jaotus",backgroundColor:["#5EBD9B","#F8DA62","#104D83","#F79F3D","#72CAD8","#E34F5B","#A048A4"],data:[this.analysis.syntaxErrorCount,this.analysis.nonExistentValueCount,this.analysis.constraintViolationCount,this.analysis.typoCount,this.analysis.aggregateErrorCount,this.analysis.alreadyExistsErrorCount,this.analysis.otherErrorCount]}]}},errorMessage(){return this.analysis.fileNames&&0!==this.analysis.fileNames.length?"Logifaili lugemine ebaõnnestus, faili sisuks ei ole PostgreSQL serveri logid.":"Logifaile ei leitud"},isStudent(){return Object.prototype.hasOwnProperty.call(this.analysis,"studentName")},hasLogFiles(){return!this.isStudent||0!==this.analysis.fileNames.length}}};const B=(0,m.Z)(T,[["render",q],["__scopeId","data-v-8154f7fe"]]);var I=B,Z={components:{AnalysisSummary:I},props:{analysisResult:{summary:{errorCount:Number,uniqueErrorCount:Number,validCount:Number,syntaxErrorCount:Number,nonExistentValueCount:Number,constraintViolationCount:Number,alreadyExistsErrorCount:Number,typoCount:Number,aggregateErrorCount:Number,otherErrors:Number,repeatedErrors:Object},analysis:[{studentName:String,fileNames:Array,errorCount:Number,uniqueErrorCount:Number,validCount:Number,syntaxErrorCount:Number,nonExistentValueCount:Number,constraintViolationCount:Number,alreadyExistsErrorCount:Number,typoCount:Number,aggregateErrorCount:Number,otherErrors:Number,repeatedErrors:Object}]}},data(){return{displayData:void 0}}};const Q=(0,m.Z)(Z,[["render",h],["__scopeId","data-v-4761ba17"]]);var H=Q,Y=(0,r.aZ)({components:{AnalysisPage:H,UploadPage:v},data(){return{showAnalysis:!1,analysis:void 0}},methods:{openAnalysis(e){this.analysis=e,console.log(this.analysis),this.showAnalysis=!0}}});const G=(0,m.Z)(Y,[["render",s]]);var J=G,X=(a(8026),a(8727)),ee=a(2846),te=a(8600),ae=a(1831);const ne=(0,X.Rd)({components:{...ee,VDataTable:ae.y_},directives:te});(0,n.ri)(J).use(ne).mount("#app")}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(t,n,r,s){if(!n){var l=1/0;for(d=0;d<e.length;d++){n=e[d][0],r=e[d][1],s=e[d][2];for(var i=!0,o=0;o<n.length;o++)(!1&s||l>=s)&&Object.keys(a.O).every((function(e){return a.O[e](n[o])}))?n.splice(o--,1):(i=!1,s<l&&(l=s));if(i){e.splice(d--,1);var u=r();void 0!==u&&(t=u)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,r,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,s,l=n[0],i=n[1],o=n[2],u=0;if(l.some((function(t){return 0!==e[t]}))){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(o)var d=o(a)}for(t&&t(n);u<l.length;u++)s=l[u],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(d)},n=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(7040)}));n=a.O(n)})();
//# sourceMappingURL=app.4197df2c.js.map